# Click & Scrape - Chrome 扩展

一个智能的 Chrome 浏览器扩展，用于可视化选择网页元素并生成最适合的 CSS 选择器。特别针对列表、表格等相似元素进行了算法优化。

## 功能特点

- 🎯 **智能可视化选择**：鼠标悬停高亮显示元素
- 🔧 **列表元素优化**：针对相似兄弟元素的特殊处理 ⭐ **新增**
- 📝 **多选择器生成**：自动生成多种类型的 CSS 选择器
- 📊 **历史记录表格**：记录所有选中的元素信息，带选择器质量指示
- 💾 **持久化存储**：使用 localStorage 保存历史记录
- 🚀 **一键启动**：点击扩展图标直接开启选择模式
- 📋 **一键复制**：点击选择器代码即可复制到剪贴板

## 安装方法

1. 打开 Chrome 浏览器，在地址栏输入 `chrome://extensions`
2. 打开右上角的 **开发者模式** 开关
3. 点击左上角的 **加载已解压的扩展程序** 按钮
4. 选择本项目的文件夹

安装完成后，你会在浏览器工具栏看到 "Click & Scrape" 扩展图标。

## 使用方法

### 基本操作

1. **启动选择模式**
   - 点击浏览器工具栏中的 "Click & Scrape" 扩展图标
   - 扩展会直接开启元素选择模式（无需弹窗）

2. **选择元素**
   - 移动鼠标到目标元素上，元素会被蓝色边框高亮显示
   - 右上角会显示一个蓝色信息面板，实时显示当前悬停元素的信息
   - 点击目标元素完成选择

3. **查看结果**
   - 选中元素后，信息面板会自动更新
   - 显示当前元素信息和历史记录表格

4. **退出选择模式**
   - 按 `ESC` 键退出选择模式

### 信息面板功能

信息面板分为两个部分：

#### 当前元素信息
- **Tag**：HTML 标签名
- **Text**：元素文本内容
- **Best Selector**：推荐的最佳 CSS 选择器

#### 历史记录表格
包含以下列：
- **Tag**：元素标签名
- **Content**：元素文本内容（截断显示）
- **Selector**：CSS 选择器（点击可复制）
- **Time**：选择时间

### 高级功能

1. **复制选择器**
   - 点击历史记录表格中的选择器代码即可复制到剪贴板
   - 复制时会有视觉反馈（背景色变化）

2. **清除历史记录**
   - 点击信息面板中的 "Clear" 按钮
   - 确认后清除所有历史记录

3. **持久化存储**
   - 历史记录自动保存到 localStorage
   - 重新启动浏览器后历史记录仍然保留
   - 最多保存 20 条历史记录

## 生成的选择器类型

扩展会智能生成多种类型的 CSS 选择器，根据元素所在环境调整优先级：

### 🎯 通用优先级（独立元素）
1. **ID 选择器**：`#elementId` - 最精确、最稳定
2. **测试属性选择器**：`[data-testid="value"]` - 测试友好
3. **重要属性选择器**：`[name="value"]`、`[aria-label="value"]` 等
4. **Class 选择器**：`.className` - 单个或多个 class 组合
5. **基于父元素的选择器**：`#parent > div`
6. **文本内容选择器**：`div:contains("text")` (非标准CSS)

### 🔧 列表元素专用优先级 ⭐ **新增**
当检测到元素在相似兄弟列表中时：
1. **ID 选择器**：`#elementId` - 仍然最高优先级
2. **父元素+索引选择器**：`#parent > li:nth-of-type(2)` - 🚀 **优先推荐**
3. **测试属性选择器**：优先级降低
4. **其他属性/Class 选择器**：优先级降低
5. **文本内容选择器**：大幅降级（因为列表中内容最易变）

### 📊 选择器质量指示
历史记录表格中会显示质量标识：
- ✅🔒 **ID/测试属性**：最稳定，推荐用于生产
- ✅🔒 **Class选择器**：较稳定
- ⚠️ **位置索引**：结构变化可能影响
- ⚠️ **其他**：需要谨慎使用

### 🎯 适用的列表类型
- `<ul>`, `<ol>` 列表项
- `<table>` 表格行/单元格  
- 产品卡片/网格布局
- 导航菜单项
- 任何结构相似的兄弟元素

## 技术特点

- **无弹窗设计**：点击扩展图标直接启动，操作更简洁
- **实时预览**：鼠标悬停时实时显示元素信息
- **智能选择器**：自动生成多种类型的选择器，适应不同使用场景
- **表格化历史**：清晰的历史记录表格，信息一目了然
- **本地存储**：使用 localStorage 确保数据持久化

## 适用场景

- **前端开发**：快速获取页面元素的 CSS 选择器
- **自动化测试**：为测试脚本生成可靠的选择器
- **网页分析**：分析页面结构和元素关系
- **学习研究**：了解不同选择器的生成规则

## 🧪 测试验证

项目包含了一个测试页面 `test.html`，用于验证算法改进效果：

```bash
# 在浏览器中打开测试页面
open test.html
```

### 测试场景
1. **无序列表**：验证列表项选择器生成
2. **产品网格**：验证卡片元素选择器生成
3. **数据表格**：验证表格行选择器生成
4. **独立元素**：验证非列表元素的传统选择器生成

### 预期结果
- 多表格环境中的元素生成唯一选择器（如 `#today-airdrops td:nth-of-type(1)`）
- 不再出现非唯一选择器（如 `tr > td:nth-child(1)`）
- 优先使用祖先ID/属性组合的稳定选择器
- 历史记录表格中显示正确的质量指示标识

### 🔧 调试测试
在页面控制台中运行调试脚本：
```bash
# 在浏览器中打开 alpha.html 页面
open test/alpha.html

# 在控制台中加载调试脚本内容
# (复制 debug-console.js 中的内容并粘贴到控制台)
```

**控制台测试命令示例：**
```javascript
// 测试特定元素的选择器生成
const element = document.querySelector('#today-airdrops td');
testElementSelector(element, '表格单元格');

// 验证选择器唯一性
const selector = '#today-airdrops td:nth-of-type(1)';
console.log('唯一性:', document.querySelectorAll(selector).length === 1);
```

## 💻 技术实现

### 核心算法函数
- `isElementInSimilarSiblingsList()` - 检测相似兄弟元素
- `getElementStructuralFeatures()` - 分析元素结构特征
- `generateParentBasedIndexSelector()` - 生成父元素+索引选择器
- `areFeaturesStructurallySimilar()` - 判断结构相似性

### 优化逻辑
1. 识别列表项、表格行等典型重复结构
2. 比较兄弟元素的结构特征（子元素、class等）
3. 在相似环境中调整选择器类型的优先级
4. 为列表元素提供更稳定的定位方案

## 注意事项

- 🎯 **算法优化**：列表元素优先使用父元素+索引，避免依赖易变的文本内容
- 📝 **选择器建议**：ID选择器仍然是最稳定的选择，其次是测试属性选择器
- 💾 **存储限制**：历史记录最多保存 20 条，超出会自动删除最旧的记录
- ⌨️ **快捷操作**：使用 ESC 键可以随时退出选择模式
- 🔐 **权限需求**：扩展需要 "activeTab" 和 "scripting" 权限来注入脚本

## 📝 更新日志

### v1.2 - 算法核心重构 🚀 **最新**
- ⚡ **完全重写选择器生成算法**，解决多表格环境下的唯一性问题
- 🎯 **实现祖先基础选择器**：自动向上查找有唯一标识的祖先元素
- 🔍 **新增特异性评分系统**：确保选择器按稳定性和唯一性排序
- 🛡️ **强化唯一性验证**：所有选择器保证在页面中唯一匹配
- 📊 **优化算法优先级**：ID > 测试属性 > 祖先路径 > 其他方案
- 🔧 **解决关键问题**：不再生成如 `tr > td:nth-child(1)` 这样的非唯一选择器
- 📋 **新增调试工具**：控制台测试脚本和详细的测试文档

### v1.1 - 列表元素算法优化
- ✨ 新增相似兄弟元素自动检测
- 🎯 实现智能的父元素+索引选择器生成
- 📊 优化选择器优先级排序逻辑
- 📉 降低文本内容选择器在列表环境中的优先级
- 🧪 添加全面的测试用例和说明文档
- 📈 提升列表/表格元素选择器的稳定性

### v1.0 - 基础功能
- 🎉 基础CSS选择器生成功能
- 📋 历史记录和复制功能  
- 🎨 可拖拽的信息面板
- 💾 本地存储支持

